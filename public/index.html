<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Shift Notes & Inventory Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            line-height: 1.6;
            color: #1a202c;
        }

        /* Login Styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 420px;
            border: 1px solid #e2e8f0;
        }

        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-header h1 {
            color: #1a202c;
            margin-bottom: 8px;
            font-size: 28px;
            font-weight: 700;
        }

        .login-header p {
            color: #718096;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.2s;
            background-color: #ffffff;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .login-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #fecaca;
            font-size: 14px;
        }

        /* Main App Styles */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            border-right: 1px solid #334155;
        }

        .sidebar-header {
            padding: 32px 24px;
            border-bottom: 1px solid #334155;
        }

        .sidebar-header h2 {
            margin-bottom: 8px;
            font-size: 20px;
            font-weight: 700;
            color: #f1f5f9;
        }

        .user-info {
            font-size: 14px;
            color: #94a3b8;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            width: 100%;
            padding: 16px 24px;
            background: none;
            border: none;
            color: #cbd5e1;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(59, 130, 246, 0.1);
            border-left-color: #3b82f6;
            color: #f1f5f9;
        }

        .nav-item.active {
            background: rgba(59, 130, 246, 0.15);
            border-left-color: #3b82f6;
            color: #60a5fa;
        }

        .nav-item.logout {
            margin-top: 20px;
            border-top: 1px solid #334155;
            color: #f87171;
        }

        .nav-item.logout:hover {
            background: rgba(248, 113, 113, 0.1);
            border-left-color: #f87171;
        }

        .main-content {
            margin-left: 280px;
            flex: 1;
            background: #f8fafc;
            min-height: 100vh;
        }

        .page-header {
            background: white;
            padding: 24px 32px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .page-header h1 {
            font-size: 24px;
            color: #111827;
            margin-bottom: 4px;
            font-weight: 700;
        }

        .page-header p {
            color: #6b7280;
            font-size: 14px;
        }

        .page-content {
            padding: 32px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Button Styles */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }

        /* Modern Card Styles */
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .card-header {
            padding: 24px 24px 0 24px;
            border-bottom: 1px solid #f3f4f6;
            margin-bottom: 24px;
        }

        .card-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }

        .card-body {
            padding: 24px;
        }

        /* Shift Notes Specific Styles */
        .shift-header {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 16px;
            align-items: center;
            margin-bottom: 32px;
        }

        .shift-title-input {
            font-size: 20px;
            font-weight: 600;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: white;
        }

        .shift-title-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .date-input, .shift-select {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            background: white;
        }

        .date-input:focus, .shift-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Daily Audits */
        .audits-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .audit-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: #f8fafc;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .audit-item:hover {
            background: #f1f5f9;
            border-color: #e5e7eb;
        }

        .audit-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #3b82f6;
            cursor: pointer;
        }

        .audit-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
        }

        /* Task Styles */
        .task-container {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            transition: all 0.2s;
        }

        .task-container:hover {
            border-color: #d1d5db;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .task-header {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 16px;
            margin-bottom: 16px;
        }

        .task-title {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
        }

        .task-status {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            min-width: 140px;
        }

        .task-description {
            width: 100%;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            resize: vertical;
            min-height: 120px;
            margin-bottom: 16px;
        }

        .task-footer {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 16px;
            align-items: start;
            margin-bottom: 24px;
        }

        .servicenow-ticket {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.2s;
            background: white;
        }

        .servicenow-ticket:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Inventory Section Styles */
        .inventory-section {
            margin-top: 24px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
        }

        .inventory-section label {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            display: block;
        }

        .inventory-search {
            position: relative;
            margin-bottom: 16px;
        }

        .inventory-search input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.2s;
            background: white;
        }

        .inventory-search input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn-outline {
            background: white;
            border: 2px solid #3b82f6;
            color: #3b82f6;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-outline:hover {
            background: #3b82f6;
            color: white;
        }

        /* File Upload Areas */
        .upload-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 10px;
            padding: 24px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #f9fafb;
        }

        .upload-area:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .upload-area span {
            display: block;
            font-size: 13px;
            color: #6b7280;
            margin-top: 8px;
        }

        .inventory-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .selected-inventory-items {
            margin-top: 16px;
        }

        .selected-inventory-items .inventory-item {
            border-left: 4px solid #3b82f6;
        }

        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .search-result {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s;
        }

        .search-result:hover {
            background: #f8fafc;
        }

        .search-result:last-child {
            border-bottom: none;
        }

        /* Add Task Button */
        .add-task-btn {
            width: 100%;
            padding: 20px;
            border: 2px dashed #3b82f6;
            background: #eff6ff;
            color: #3b82f6;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 24px;
        }

        .add-task-btn:hover {
            background: #dbeafe;
            border-color: #1d4ed8;
            color: #1d4ed8;
        }

        /* Global button styling for all buttons */
        button {
            cursor: pointer;
            transition: all 0.2s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-1px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        /* Alert Styles */
        .alert {
            padding: 16px 20px;
            border-radius: 10px;
            margin-bottom: 24px;
            font-size: 14px;
            font-weight: 500;
            border: 1px solid;
        }

        .alert-success {
            background: #ecfdf5;
            color: #065f46;
            border-color: #a7f3d0;
        }

        .alert-error {
            background: #fef2f2;
            color: #991b1b;
            border-color: #fecaca;
        }

        .alert-warning {
            background: #fffbeb;
            color: #92400e;
            border-color: #fed7aa;
        }

        .alert-info {
            background: #eff6ff;
            color: #1e40af;
            border-color: #bfdbfe;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .shift-header {
                grid-template-columns: 1fr;
            }
            
            .audits-grid {
                grid-template-columns: 1fr;
            }
            
            .task-header {
                grid-template-columns: 1fr;
            }
            
            .upload-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <h1>üîß IT Shift System</h1>
                <p>Enhanced shift notes and inventory management</p>
            </div>
            
            <div id="login-error" class="error-message hidden"></div>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required>
                </div>
                
                <button type="submit" class="login-btn">
                    <span id="login-text">Sign In</span>
                    <span id="login-loading" class="hidden">Signing in...</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container" class="app-container hidden">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>NoInventory</h2>
                <div class="user-info">
                    Welcome <span id="user-name">User</span><br>
                    <span id="user-role">Role</span>
                </div>
            </div>
            
            <nav class="nav-menu">
                <button class="nav-item active" data-page="shift-notes">üìù Daily Shift Note</button>
                <button class="nav-item" data-page="teams-notes">üë• Teams Shift Notes</button>
                <button class="nav-item" data-page="handoff-notes">üìã Handoff Notes</button>
                <button class="nav-item" data-page="inventory">üì¶ Inventory</button>
                <button class="nav-item" data-page="reports">üìä Reports</button>
                <button class="nav-item" data-page="backup-settings">‚öôÔ∏è Backup/Settings</button>
                <button class="nav-item" data-page="users" id="users-nav">üë• User Management</button>
                <button class="nav-item logout" onclick="logout()">üö™ Logout</button>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="page-header">
                <div>
                    <h1 id="page-title">Daily Equipment Shift Notes</h1>
                    <p id="page-subtitle">Integrated shift documentation and inventory management</p>
                </div>
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-secondary" onclick="saveShiftNote()" style="background: #6b7280; color: white; border: none; padding: 12px 24px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">üíæ Save Shift</button>
                    <button class="btn btn-primary" onclick="generateShiftSummary()" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; padding: 12px 24px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">üìÑ Generate Summary</button>
                </div>
            </div>
            
            <div class="page-content" id="page-content">
                <!-- Page content will be loaded here dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let authToken = localStorage.getItem('authToken');
        let currentUser = null;
        let currentShift = null;
        let currentPage = 'shift-notes';
        let inventoryData = [];
        let taskCounter = 1;

        // API Configuration
        const API_BASE = ''; // Using relative paths since frontend will be served from same domain

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing Enhanced IT Shift System...');
            
            initializeEventListeners();
            populateDailyAudits();
            setCurrentDate();
            loadCurrentShift();
            
            if (authToken) {
                validateTokenAndShowApp();
            } else {
                showLogin();
            }
        });

        function initializeEventListeners() {
            // Login form
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            // Navigation
            document.querySelectorAll('.nav-item[data-page]').forEach(item => {
                item.addEventListener('click', function() {
                    navigateTo(this.dataset.page);
                });
            });
        }

        function populateDailyAudits() {
            const auditsContainer = document.getElementById('daily-audits');
            // Use the existing daily_audits from your database
            const dailyAudits = [
                'TEL Lane WherePort',
                'Gate Lane WherePort', 
                'TEL Enter/Exit WherePort Test',
                'Mechanics Availability Report',
                'QuickBase Dashboard Audit'
            ];
            
            auditsContainer.innerHTML = dailyAudits.map(audit => `
                <label class="audit-item">
                    <input type="checkbox" class="audit-checkbox" value="${audit}">
                    <span class="audit-label">${audit}</span>
                </label>
            `).join('');
        }

        function setCurrentDate() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('shift-date');
            if (dateInput) {
                dateInput.value = today;
            }
        }

        // Enhanced inventory search function that works with both inline and regular search
        async function searchInventory(input) {
            const dropdown = input.nextElementSibling;
            const query = input.value.toLowerCase();
            
            if (query.length < 2) {
                dropdown.classList.add('hidden');
                return;
            }
            
            try {
                // For now, use mock data (replace with real API call when backend is connected)
                const mockResults = [
                    { id: 1, part_number: 'A3233-32', vendor: 'Cisco Systems', product: '9300-CX Switch', description: 'STS Crane Switch', quantity: 8 },
                    { id: 2, part_number: 'B21223', vendor: 'Cisco Systems', product: 'SFP-DL-LC', description: 'SFP Module', quantity: 20 },
                    { id: 3, part_number: 'C12345', vendor: 'Dell', product: 'PowerEdge Server', description: 'Rack Server', quantity: 3 },
                    { id: 4, part_number: 'D67890', vendor: 'HP', product: 'ProLiant', description: 'Blade Server', quantity: 12 }
                ].filter(item => 
                    item.part_number.toLowerCase().includes(query) ||
                    item.vendor.toLowerCase().includes(query) ||
                    item.product.toLowerCase().includes(query) ||
                    item.description.toLowerCase().includes(query)
                );
                
                if (mockResults.length > 0) {
                    dropdown.innerHTML = mockResults.map(item => `
                        <div class="search-result" onclick="selectInventoryItem(this, ${item.id})">
                            <div style="font-weight: 500;">${item.part_number} - ${item.product}</div>
                            <div style="font-size: 12px; color: #6b7280;">${item.vendor} | ${item.description} | Qty: ${item.quantity}</div>
                        </div>
                    `).join('');
                    dropdown.classList.remove('hidden');
                } else {
                    dropdown.classList.add('hidden');
                }
                
                // Uncomment when connecting to real backend:
                /*
                const response = await fetch(`/api/inventory/search?q=${encodeURIComponent(query)}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const results = await response.json();
                    
                    if (results.length > 0) {
                        dropdown.innerHTML = results.map(item => `
                            <div class="search-result" onclick="selectInventoryItem(this, ${item.id})">
                                <div style="font-weight: 500;">${item.part_number} - ${item.product}</div>
                                <div style="font-size: 12px; color: #6b7280;">${item.vendor} | ${item.description} | Qty: ${item.quantity}</div>
                            </div>
                        `).join('');
                        dropdown.classList.remove('hidden');
                    } else {
                        dropdown.classList.add('hidden');
                    }
                }
                */
            } catch (error) {
                console.error('Error searching inventory:', error);
                dropdown.classList.add('hidden');
            }
        }

        // Load current shift data
        async function loadCurrentShift() {
            try {
                // For now, use empty mock data (replace with real API call when backend is connected)
                const mockShiftData = {
                    title: '',
                    date: new Date().toISOString().split('T')[0],
                    shift_type: 'day',
                    completed_audits: [],
                    tasks: []
                };
                
                populateShiftData(mockShiftData);
                
                // Uncomment when connecting to real backend:
                /*
                const response = await fetch('/api/shifts/current', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const shiftData = await response.json();
                    populateShiftData(shiftData);
                } else {
                    // No current shift, create new one
                    const newShiftData = {
                        title: '',
                        date: new Date().toISOString().split('T')[0],
                        shift_type: 'day',
                        completed_audits: [],
                        tasks: []
                    };
                    populateShiftData(newShiftData);
                }
                */
            } catch (error) {
                console.error('Error loading current shift:', error);
                // Fallback to empty shift data
                const fallbackData = {
                    title: '',
                    date: new Date().toISOString().split('T')[0],
                    shift_type: 'day',
                    completed_audits: [],
                    tasks: []
                };
                populateShiftData(fallbackData);
            }
        }

        function populateShiftData(shiftData) {
            if (shiftData.shift) {
                document.getElementById('shift-title').value = shiftData.shift.title || '';
                document.getElementById('shift-date').value = shiftData.shift.shift_date || '';
                document.getElementById('shift-type').value = shiftData.shift.shift_type || 'day';
            }
            
            // Populate audit checkboxes
            if (shiftData.audits) {
                const checkboxes = document.querySelectorAll('.audit-checkbox');
                const completedAudits = JSON.parse(shiftData.audits.completed_audits || '[]');
                checkboxes.forEach(checkbox => {
                    if (completedAudits.includes(checkbox.value)) {
                        checkbox.checked = true;
                    }
                });
            }
            
            // Always populate tasks (either existing or default empty one)
            populateExistingTasks(shiftData.tasks || []);
        }

        function populateExistingTasks(tasks) {
            const tasksContainer = document.getElementById('tasks-container');
            // Clear existing task container
            tasksContainer.innerHTML = '';
            
            if (tasks && tasks.length > 0) {
                tasks.forEach(task => {
                    const taskElement = createTaskElement(task);
                    tasksContainer.appendChild(taskElement);
                });
            } else {
                // Create a default empty task if no tasks exist
                const defaultTask = createTaskElement();
                tasksContainer.appendChild(defaultTask);
            }
        }

        function loadShiftNotesPage() {
            const pageContent = document.getElementById('page-content');
            pageContent.innerHTML = `
                <!-- Shift Header -->
                <div class="shift-header">
                    <input type="text" class="shift-title-input" id="shift-title" placeholder="Daily Equipment Shift Notes on - [date] - [shift]" value="Daily Equipment Shift Notes">
                    <input type="date" class="date-input" id="shift-date">
                    <select class="shift-select" id="shift-type">
                        <option value="day">Day Shift</option>
                        <option value="evening">Evening Shift</option>
                        <option value="night">Night Shift</option>
                        <option value="weekend">Weekend Shift</option>
                    </select>
                </div>

                <!-- Daily Audits Section -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìã Daily Audits</h3>
                    </div>
                    <div class="card-body">
                        <div class="audits-grid" id="daily-audits">
                            <!-- Audits will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Tasks Section -->
                <div id="tasks-container">
                    <!-- Default task will be added here -->
                    <div class="task-container" style="margin-bottom: 24px; border: 2px solid #e5e7eb; border-radius: 16px; padding: 24px; background: white;">
                        <div class="task-header" style="display: grid; grid-template-columns: 1fr auto; gap: 16px; margin-bottom: 16px;">
                            <input type="text" class="task-title" placeholder="Task title" style="padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;" />
                            <select class="task-status" style="padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white; min-width: 140px;">
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                                <option value="blocked">Blocked</option>
                            </select>
                        </div>
                        
                        <textarea class="task-description" placeholder="Description..." style="width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; resize: vertical; min-height: 120px; margin-bottom: 16px; background: white;"></textarea>
                        
                        <!-- ServiceNow Input Field -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 14px;">ServiceNow Ticket Number:</label>
                            <input type="text" class="servicenow-input" placeholder="Type RITM or INC number here..." style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                        </div>
                        
                        <!-- Inventory Search Input Field -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 14px;">Search Inventory Items:</label>
                            <input type="text" class="inventory-search-input" placeholder="Type to search inventory and add items..." style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;" onkeyup="searchInventoryInline(this)">
                            <div class="search-results-dropdown" style="display: none; position: relative; background: white; border: 1px solid #e5e7eb; border-radius: 8px; margin-top: 4px; max-height: 200px; overflow-y: auto;"></div>
                            <div class="selected-items-display" style="margin-top: 16px; padding: 16px; background: #f8fafc; border-radius: 8px; border: 2px dashed #d1d5db;">
                                <div style="text-align: center; color: #6b7280; font-style: italic;">No inventory items selected</div>
                            </div>
                        </div>
                        
                        <!-- File Upload Areas -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 14px;">File Attachments:</label>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                                <div class="upload-area" onclick="triggerFileUpload(this)" style="border: 2px dashed #d1d5db; border-radius: 10px; padding: 24px 16px; text-align: center; cursor: pointer; background: #f9fafb;">
                                    üì∏<span style="display: block; font-size: 13px; color: #6b7280; margin-top: 8px;">Upload Image</span>
                                    <input type="file" accept="image/*,application/pdf,.pdf" style="display: none;">
                                </div>
                                <div class="upload-area" onclick="triggerFileUpload(this)" style="border: 2px dashed #d1d5db; border-radius: 10px; padding: 24px 16px; text-align: center; cursor: pointer; background: #f9fafb;">
                                    üì∏<span style="display: block; font-size: 13px; color: #6b7280; margin-top: 8px;">Upload Image</span>
                                    <input type="file" accept="image/*,application/pdf,.pdf" style="display: none;">
                                </div>
                                <div class="upload-area" onclick="triggerFileUpload(this)" style="border: 2px dashed #d1d5db; border-radius: 10px; padding: 24px 16px; text-align: center; cursor: pointer; background: #f9fafb;">
                                    üì∏<span style="display: block; font-size: 13px; color: #6b7280; margin-top: 8px;">Upload Image</span>
                                    <input type="file" accept="image/*,application/pdf,.pdf" style="display: none;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Additional Task Button -->
                <button class="add-task-btn" onclick="addAdditionalTask()" style="width: 100%; padding: 20px; border: 2px dashed #3b82f6; background: #eff6ff; color: #3b82f6; border-radius: 16px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 24px;">
                    ‚ûï Add Additional Task
                </button>
            `;
            
            populateDailyAudits();
            setCurrentDate();
        }

        function searchInventoryInline(input) {
            const dropdown = input.nextElementSibling;
            const query = input.value.toLowerCase();
            
            if (query.length < 2) {
                dropdown.style.display = 'none';
                return;
            }
            
            // Mock search for now - replace with real API call
            const mockResults = [
                { id: 1, part_number: 'A3233-32', vendor: 'Cisco Systems', product: '9300-CX Switch', quantity: 8 },
                { id: 2, part_number: 'B21223', vendor: 'Cisco Systems', product: 'SFP-DL-LC', quantity: 20 }
            ].filter(item => 
                item.part_number.toLowerCase().includes(query) ||
                item.vendor.toLowerCase().includes(query) ||
                item.product.toLowerCase().includes(query)
            );
            
            if (mockResults.length > 0) {
                dropdown.innerHTML = mockResults.map(item => `
                    <div onclick="selectItem(this, ${item.id})" style="padding: 12px; cursor: pointer; border-bottom: 1px solid #f3f4f6;">
                        <div style="font-weight: 500;">${item.part_number} - ${item.product}</div>
                        <div style="font-size: 12px; color: #6b7280;">${item.vendor} | Qty: ${item.quantity}</div>
                    </div>
                `).join('');
                dropdown.style.display = 'block';
            } else {
                dropdown.style.display = 'none';
            }
        }

        function selectItem(element, itemId) {
            const container = element.closest('.task-container');
            const selectedDisplay = container.querySelector('.selected-items-display');
            const searchInput = container.querySelector('.inventory-search-input');
            const dropdown = container.querySelector('.search-results-dropdown');
            
            // Add item to selected display
            if (selectedDisplay.innerHTML.includes('No inventory items selected')) {
                selectedDisplay.innerHTML = '';
            }
            
            const itemDiv = document.createElement('div');
            itemDiv.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border-radius: 6px; margin-bottom: 8px; border: 1px solid #e5e7eb;';
            itemDiv.innerHTML = `
                <span>${element.querySelector('div').textContent}</span>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="number" value="1" min="1" style="width: 60px; padding: 4px 8px; border: 1px solid #e5e7eb; border-radius: 4px;">
                    <button onclick="this.parentElement.parentElement.remove()" style="color: #ef4444; background: none; border: none; cursor: pointer;">‚úï</button>
                </div>
            `;
            selectedDisplay.appendChild(itemDiv);
            
            // Clear search
            searchInput.value = '';
            dropdown.style.display = 'none';
        }

        function createTaskElement(task = {}) {
            const taskDiv = document.createElement('div');
            taskDiv.className = 'task-container';
            taskDiv.innerHTML = `
                <div class="task-header">
                    <input type="text" class="task-title" placeholder="Task title" value="${task.title || ''}" />
                    <select class="task-status">
                        <option value="active" ${task.status === 'active' ? 'selected' : ''}>Active</option>
                        <option value="completed" ${task.status === 'completed' ? 'selected' : ''}>Completed</option>
                        <option value="blocked" ${task.status === 'blocked' ? 'selected' : ''}>Blocked</option>
                    </select>
                </div>
                
                <textarea class="task-description" placeholder="Description...">${task.description || ''}</textarea>
                
                <!-- ServiceNow Ticket Input Field -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151; font-size: 14px;">ServiceNow Ticket (RITM/INC):</label>
                    <input type="text" class="servicenow-ticket" placeholder="Enter ticket number (e.g., RITM1234567, INC7654321)" value="${task.ticket_number || ''}" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                </div>
                
                <!-- Inventory Search Input Field -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151; font-size: 14px;">Inventory Items Used:</label>
                    <div class="inventory-search" style="position: relative; margin-bottom: 16px;">
                        <input type="text" placeholder="üîç Type to search and add inventory items..." onkeyup="searchInventory(this)" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                        <div class="search-dropdown hidden"></div>
                    </div>
                    <div class="selected-inventory-items">
                        <div class="inventory-placeholder" style="text-align: center; color: #6b7280; font-size: 14px; padding: 16px; font-style: italic; background: #f8fafc; border-radius: 8px;">Search above to add inventory items to this task</div>
                    </div>
                </div>
                
                <!-- File Upload Areas -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151; font-size: 14px;">File Attachments:</label>
                    <div class="upload-grid">
                        <div class="upload-area" onclick="triggerFileUpload(this)">
                            üì∏<span>Upload Image</span>
                            <input type="file" accept="image/*,application/pdf,.pdf" style="display: none;">
                        </div>
                        <div class="upload-area" onclick="triggerFileUpload(this)">
                            üì∏<span>Upload Image</span>
                            <input type="file" accept="image/*,application/pdf,.pdf" style="display: none;">
                        </div>
                        <div class="upload-area" onclick="triggerFileUpload(this)">
                            üì∏<span>Upload Image</span>
                            <input type="file" accept="image/*,application/pdf,.pdf" style="display: none;">
                        </div>
                    </div>
                </div>
            `;
            return taskDiv;
        }

        // Real inventory search using your API
        async function searchInventory(input) {
            const dropdown = input.nextElementSibling;
            const query = input.value.toLowerCase();
            
            if (query.length < 2) {
                dropdown.classList.add('hidden');
                return;
            }
            
            try {
                const response = await fetch(`/api/inventory/search?q=${encodeURIComponent(query)}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const results = await response.json();
                    
                    if (results.length > 0) {
                        dropdown.innerHTML = results.map(item => `
                            <div class="search-result" onclick="selectInventoryItem(this, ${item.id})">
                                <div style="font-weight: 500;">${item.part_number} - ${item.product}</div>
                                <div style="font-size: 12px; color: #6b7280;">${item.vendor} | ${item.description} | Qty: ${item.quantity}</div>
                            </div>
                        `).join('');
                        dropdown.classList.remove('hidden');
                    } else {
                        dropdown.classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('Error searching inventory:', error);
                dropdown.classList.add('hidden');
            }
        }

        async function selectInventoryItem(element, itemId) {
            try {
                // For now, use mock data (replace with real API call when backend is connected)
                const mockItems = [
                    { id: 1, part_number: 'A3233-32', vendor: 'Cisco Systems', product: '9300-CX Switch', description: 'STS Crane Switch', quantity: 8 },
                    { id: 2, part_number: 'B21223', vendor: 'Cisco Systems', product: 'SFP-DL-LC', description: 'SFP Module', quantity: 20 },
                    { id: 3, part_number: 'C12345', vendor: 'Dell', product: 'PowerEdge Server', description: 'Rack Server', quantity: 3 },
                    { id: 4, part_number: 'D67890', vendor: 'HP', product: 'ProLiant', description: 'Blade Server', quantity: 12 }
                ];
                
                const item = mockItems.find(i => i.id === itemId);
                
                if (!item) {
                    showAlert('error', 'Item not found');
                    return;
                }
                
                const dropdown = element.closest('.search-dropdown');
                const taskContainer = dropdown.closest('.task-container');
                const selectedItemsContainer = taskContainer.querySelector('.selected-inventory-items');
                const placeholder = selectedItemsContainer.querySelector('.inventory-placeholder');
                
                // Hide placeholder and dropdown
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
                dropdown.classList.add('hidden');
                
                // Check if item already selected
                const existingItem = selectedItemsContainer.querySelector(`[data-item-id="${item.id}"]`);
                if (existingItem) {
                    showAlert('warning', 'Item already added to this task');
                    dropdown.previousElementSibling.value = '';
                    return;
                }
                
                // Add item to display
                const itemDiv = document.createElement('div');
                itemDiv.className = 'inventory-item';
                itemDiv.setAttribute('data-item-id', item.id);
                itemDiv.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);';
                itemDiv.innerHTML = `
                    <div style="flex: 1;">
                        <strong>${item.part_number}</strong> - ${item.product}
                        <div style="font-size: 12px; color: #6b7280;">${item.vendor} | ${item.description} | Available: ${item.quantity}</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 12px; color: #6b7280;">Qty:</label>
                        <input type="number" value="1" min="1" max="${item.quantity}" style="width: 60px; padding: 4px 8px; border: 1px solid #e5e7eb; border-radius: 4px;" onchange="updateInventoryQuantity(this, ${item.id})">
                        <button onclick="removeInventoryItem(this)" style="color: #ef4444; background: none; border: none; cursor: pointer; font-size: 16px; padding: 4px;">‚úï</button>
                    </div>
                `;
                selectedItemsContainer.appendChild(itemDiv);
                
                // Clear search input
                dropdown.previousElementSibling.value = '';
                
                showAlert('success', `Added ${item.part_number} to task`);
                
                // Uncomment when connecting to real backend:
                /*
                const response = await fetch(`/api/inventory/${itemId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const item = await response.json();
                    // ... rest of the logic with real API data
                }
                */
            } catch (error) {
                console.error('Error selecting inventory item:', error);
                showAlert('error', 'Error adding inventory item: ' + error.message);
            }
        }

        function updateInventoryQuantity(input, itemId) {
            const quantity = parseInt(input.value);
            const maxQuantity = parseInt(input.max);
            
            if (quantity > maxQuantity) {
                showAlert('warning', `Only ${maxQuantity} items available in stock`);
                input.value = maxQuantity;
            }
        }

        function removeInventoryItem(button) {
            const taskContainer = button.closest('.task-container');
            const selectedItemsContainer = taskContainer.querySelector('.selected-inventory-items');
            button.closest('.inventory-item').remove();
            
            // Show placeholder if no items left
            const remainingItems = selectedItemsContainer.querySelectorAll('.inventory-item');
            if (remainingItems.length === 0) {
                const placeholder = selectedItemsContainer.querySelector('.inventory-placeholder');
                if (placeholder) {
                    placeholder.style.display = 'block';
                }
            }
            
            showAlert('info', 'Item removed from task');
        }

        function triggerFileUpload(uploadArea) {
            const fileInput = uploadArea.querySelector('input[type="file"]');
            if (fileInput) {
                fileInput.click();
                
                fileInput.onchange = function(e) {
                    if (e.target.files.length > 0) {
                        const fileName = e.target.files[0].name;
                        const fileSize = (e.target.files[0].size / 1024 / 1024).toFixed(2);
                        uploadArea.innerHTML = `‚úÖ<span style="display: block; font-size: 13px; color: #10b981; margin-top: 8px;">${fileName}<br>(${fileSize} MB)</span>`;
                        uploadArea.style.borderColor = '#10b981';
                        uploadArea.style.background = '#ecfdf5';
                        showAlert('success', `File "${fileName}" uploaded successfully!`);
                    }
                };
            }
        }

        function addAdditionalTask() {
            taskCounter++;
            const tasksContainer = document.getElementById('tasks-container');
            const newTask = document.createElement('div');
            newTask.className = 'task-container';
            newTask.innerHTML = `
                <div class="task-header">
                    <input type="text" class="task-title" placeholder="Task title" />
                    <select class="task-status">
                        <option value="active">Active</option>
                        <option value="completed">Completed</option>
                        <option value="blocked">Blocked</option>
                    </select>
                </div>
                
                <textarea class="task-description" placeholder="Description..."></textarea>
                
                <!-- ServiceNow Ticket Input Field -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151; font-size: 14px;">ServiceNow Ticket (RITM/INC):</label>
                    <input type="text" class="servicenow-ticket" placeholder="Enter ticket number (e.g., RITM1234567, INC7654321)" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                </div>
                
                <!-- Inventory Search Input Field -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151; font-size: 14px;">Inventory Items Used:</label>
                    <div class="inventory-search" style="position: relative; margin-bottom: 16px;">
                        <input type="text" placeholder="üîç Type to search and add inventory items..." onkeyup="searchInventory(this)" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                        <div class="search-dropdown hidden"></div>
                    </div>
                    <div class="selected-inventory-items">
                        <div class="inventory-placeholder" style="text-align: center; color: #6b7280; font-size: 14px; padding: 16px; font-style: italic; background: #f8fafc; border-radius: 8px;">Search above to add inventory items to this task</div>
                    </div>
                </div>
                
                <!-- File Upload Areas -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151; font-size: 14px;">File Attachments:</label>
                    <div class="upload-grid">
                        <div class="upload-area" onclick="triggerFileUpload(this)">
                            üì∏<span>Upload Image</span>
                            <input type="file" accept="image/*,application/pdf,.pdf" style="display: none;">
                        </div>
                        <div class="upload-area" onclick="triggerFileUpload(this)">
                            üì∏<span>Upload Image</span>
                            <input type="file" accept="image/*,application/pdf,.pdf" style="display: none;">
                        </div>
                        <div class="upload-area" onclick="triggerFileUpload(this)">
                            üì∏<span>Upload Image</span>
                            <input type="file" accept="image/*,application/pdf,.pdf" style="display: none;">
                        </div>
                    </div>
                </div>
            `;
            tasksContainer.appendChild(newTask);
        }

        // Navigation
        function navigateTo(page) {
            console.log(`üìç Navigating to: ${page}`);
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
            
            currentPage = page;
            loadPageContent(page);
        }

        function loadPageContent(page) {
            const pageContent = document.getElementById('page-content');
            const pageTitle = document.getElementById('page-title');
            const pageSubtitle = document.getElementById('page-subtitle');
            
            switch(page) {
                case 'shift-notes':
                    pageTitle.textContent = 'Daily Equipment Shift Notes';
                    pageSubtitle.textContent = 'Integrated shift documentation and inventory management';
                    loadShiftNotesPage();
                    break;
                    
                case 'teams-notes':
                    pageTitle.textContent = 'Teams Shift Notes';
                    pageSubtitle.textContent = 'View all team member shift submissions';
                    loadTeamsNotesPage();
                    break;
                    
                case 'inventory':
                    pageTitle.textContent = 'Inventory Management';
                    pageSubtitle.textContent = 'Manage and track inventory items';
                    // Force immediate inventory page load with inline content
                    pageContent.innerHTML = `
                        <div class="card">
                            <div class="card-body">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                                    <div style="position: relative; flex: 1; max-width: 400px;">
                                        <input type="text" id="inventory-search" placeholder="üîç Search Inventory" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;" onkeyup="filterInventoryTable()">
                                    </div>
                                    <div style="display: flex; gap: 12px;">
                                        <button class="btn btn-success" onclick="showImportModal()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px 24px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">üì• Import Excel</button>
                                        <button class="btn btn-primary" onclick="showAddInventoryModal()">+ Add Item</button>
                                    </div>
                                </div>
                                
                                <div style="overflow-x: auto; background: white; border-radius: 12px; border: 1px solid #e5e7eb;">
                                    <table id="inventory-table" style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background: #f8fafc;">
                                                <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; font-size: 14px;">Part #</th>
                                                <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; font-size: 14px;">Vendor</th>
                                                <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; font-size: 14px;">Product Name</th>
                                                <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; font-size: 14px;">Description</th>
                                                <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; font-size: 14px;">Location</th>
                                                <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; font-size: 14px;">Quantity</th>
                                                <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; font-size: 14px;">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr style="transition: background-color 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 1, 'part_number')">A3233-32</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 1, 'vendor')">Cisco Systems</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 1, 'product')">9300-CX Switch</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 1, 'description')">STS Crane Switch</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 1, 'location')">43-S4</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 1, 'quantity')">8</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">
                                                    <button onclick="adjustInventoryItem(1)" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px; margin-right: 8px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; border-radius: 8px; cursor: pointer;">Adjust</button>
                                                    <button onclick="deleteInventoryItem(1)" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 8px; cursor: pointer;">Delete</button>
                                                </td>
                                            </tr>
                                            <tr style="transition: background-color 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 2, 'part_number')">B21223</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 2, 'vendor')">Cisco Systems</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 2, 'product')">SFP-DL-LC</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 2, 'description')">SFP Module</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 2, 'location')">43-S4</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 2, 'quantity')">20</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">
                                                    <button onclick="adjustInventoryItem(2)" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px; margin-right: 8px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; border-radius: 8px; cursor: pointer;">Adjust</button>
                                                    <button onclick="deleteInventoryItem(2)" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 8px; cursor: pointer;">Delete</button>
                                                </td>
                                            </tr>
                                            <tr style="transition: background-color 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 3, 'part_number')">C12345</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 3, 'vendor')">Dell</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 3, 'product')">PowerEdge Server</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 3, 'description')">Rack Server</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 3, 'location')">DC-1</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer; color: #ef4444; font-weight: 600;" onclick="makeEditable(this, 3, 'quantity')">3</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">
                                                    <button onclick="adjustInventoryItem(3)" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px; margin-right: 8px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; border-radius: 8px; cursor: pointer;">Adjust</button>
                                                    <button onclick="deleteInventoryItem(3)" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 8px; cursor: pointer;">Delete</button>
                                                </td>
                                            </tr>
                                            <tr style="transition: background-color 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 4, 'part_number')">D67890</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 4, 'vendor')">HP</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 4, 'product')">ProLiant</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 4, 'description')">Blade Server</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 4, 'location')">DC-2</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;" onclick="makeEditable(this, 4, 'quantity')">12</td>
                                                <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">
                                                    <button onclick="adjustInventoryItem(4)" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px; margin-right: 8px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; border-radius: 8px; cursor: pointer;">Adjust</button>
                                                    <button onclick="deleteInventoryItem(4)" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 8px; cursor: pointer;">Delete</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div style="margin-top: 24px; padding: 16px; background: #f8fafc; border-radius: 12px; text-align: center; color: #6b7280; font-size: 14px;">
                                    üí° <strong>Click ANY cell to edit it directly!</strong> Fix spelling errors, update part numbers, change quantities, locations, etc. Press Enter to save or Escape to cancel. Red quantities indicate low stock items.
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'users':
                    pageTitle.textContent = 'User Management';
                    pageSubtitle.textContent = 'Manage system users and permissions';
                    loadUsersPage();
                    break;
                    
                case 'handoff-notes':
                    pageTitle.textContent = 'Handoff Notes';
                    pageSubtitle.textContent = 'Shift handoff documentation';
                    loadHandoffNotesPage();
                    break;
                    
                case 'backup-settings':
                    pageTitle.textContent = 'Backup & Settings';
                    pageSubtitle.textContent = 'System configuration and backup management';
                    loadBackupSettingsPage();
                    break;
                    
                case 'reports':
                    pageTitle.textContent = 'Reports';
                    pageSubtitle.textContent = 'Analytics and reporting dashboard';
                    loadReportsPage();
                    break;
                    
                default:
                    pageTitle.textContent = 'Page Not Found';
                    pageSubtitle.textContent = 'This page is under development';
                    pageContent.innerHTML = `
                        <div class="card">
                            <div class="card-body">
                                <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                                    <h3 style="margin-bottom: 16px;">üöß Under Development</h3>
                                    <p>This page is currently being developed and will be available soon.</p>
                                </div>
                            </div>
                        </div>
                    `;
            }
        }

        function loadTeamsNotesPage() {
            const pageContent = document.getElementById('page-content');
            pageContent.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h2>üìã Teams Shift Notes</h2>
                        <p>View and search all team member shift notes</p>
                    </div>
                    <div class="card-body">
                        <!-- Search and Filter Controls -->
                        <div style="display: flex; gap: 16px; margin-bottom: 24px; flex-wrap: wrap; align-items: center;">
                            <div style="position: relative; flex: 1; min-width: 300px;">
                                <input type="text" id="teams-search" placeholder="üîç Search shift notes..." style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;" onkeyup="searchTeamsNotes()">
                                <button onclick="clearTeamsSearch()" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #6b7280; cursor: pointer; font-size: 16px;">√ó</button>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="filterByDate('today')" class="btn btn-secondary" style="padding: 8px 16px; background: #6b7280; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">Today</button>
                                <button onclick="filterByDate('week')" class="btn btn-secondary" style="padding: 8px 16px; background: #6b7280; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">This Week</button>
                                <button onclick="filterByDate('month')" class="btn btn-secondary" style="padding: 8px 16px; background: #6b7280; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">This Month</button>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="filterByShift('day')" class="btn btn-secondary" style="padding: 8px 16px; background: #6b7280; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">Day Shift</button>
                                <button onclick="filterByShift('night')" class="btn btn-secondary" style="padding: 8px 16px; background: #6b7280; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">Night Shift</button>
                            </div>
                        </div>
                        
                        <!-- Teams Notes Container -->
                        <div id="teams-notes-container">
                            <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                                <h3 style="margin-bottom: 16px;">üìã No Shift Notes Yet</h3>
                                <p>Shift notes from team members will appear here once they start creating them.</p>
                                <div style="margin-top: 24px;">
                                    <button onclick="navigateTo('daily-shift')" class="btn btn-primary" style="margin: 0 8px;">Create Your First Shift Note</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadInventoryPage() {
            const pageContent = document.getElementById('page-content');
            pageContent.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div style="position: relative; flex: 1; max-width: 400px;">
                                <input type="text" placeholder="üîç Search Inventory" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;">
                            </div>
                            <button class="btn btn-primary">+ Add Item</button>
                        </div>
                        
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8fafc;">
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Part #</th>
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Vendor</th>
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Product Name</th>
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Description</th>
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Location</th>
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Quantity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${mockInventoryData.map(item => `
                                        <tr style="transition: background-color 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">${item.part_number}</td>
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">${item.vendor}</td>
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">${item.product}</td>
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">${item.description}</td>
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">${item.location}</td>
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">${item.quantity}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 24px; padding: 24px; background: #f8fafc; border-radius: 12px; text-align: center; color: #6b7280;">
                            <p>The rest are all inventory items just like any typical inventory system table that lists all items. We need to be able to edit all columns of these items to fix any errors or manually change product numbers, names quantities etc.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadReportsPage() {
            const pageContent = document.getElementById('page-content');
            pageContent.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                            <h3 style="margin-bottom: 16px;">üìä Reports Dashboard</h3>
                            <p>Advanced reporting and analytics features will be implemented here.</p>
                            <div style="margin-top: 24px;">
                                <button class="btn btn-secondary" style="margin: 0 8px;">Daily Reports</button>
                                <button class="btn btn-secondary" style="margin: 0 8px;">Inventory Reports</button>
                                <button class="btn btn-secondary" style="margin: 0 8px;">Team Performance</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadUsersPage() {
            try {
                showLoading('Loading users...');
                
                // For now, use mock data (replace with real API call when backend is connected)
                const mockUsers = [
                    { id: 1, name: 'Administrator', email: 'admin@company.com', role: 'admin', active: true, last_login: '2024-01-15T10:30:00Z' }
                ];
                
                hideLoading();
                renderUsersPage(mockUsers);
                
                // Uncomment when connecting to real backend:
                /*
                const response = await fetch('/api/users', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                hideLoading();
                
                if (response.ok) {
                    const users = await response.json();
                    renderUsersPage(users);
                } else {
                    throw new Error('Failed to load users');
                }
                */
            } catch (error) {
                hideLoading();
                console.error('Error loading users:', error);
                showAlert('error', 'Error loading users: ' + error.message);
                renderUsersPage([]); // Show empty table
            }
        }

        function renderUsersPage(users) {
            const pageContent = document.getElementById('page-content');
            
            pageContent.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div style="position: relative; flex: 1; max-width: 400px;">
                                <input type="text" id="users-search" placeholder="üîç Search Users" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;" onkeyup="filterUsersTable()">
                            </div>
                            <button class="btn btn-primary" onclick="showAddUserModal()">+ Add New User</button>
                        </div>
                        
                        <div style="overflow-x: auto;">
                            <table id="users-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8fafc;">
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Name</th>
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Email</th>
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Role</th>
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Status</th>
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Last Login</th>
                                        <th style="padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${users.map(user => `
                                        <tr style="transition: background-color 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">${user.name || user.email.split('@')[0]}</td>
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">${user.email}</td>
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">
                                                <span style="background: ${user.role === 'admin' ? '#fef2f2; color: #991b1b' : user.role === 'manager' ? '#fffbeb; color: #92400e' : '#f0f9ff; color: #1e40af'}; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 500; text-transform: uppercase;">
                                                    ${user.role}
                                                </span>
                                            </td>
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">
                                                <span style="background: ${user.active ? '#ecfdf5; color: #065f46' : '#fef2f2; color: #991b1b'}; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 500; text-transform: uppercase;">
                                                    ${user.active ? 'active' : 'inactive'}
                                                </span>
                                            </td>
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">${user.last_login ? new Date(user.last_login).toLocaleDateString() : 'Never'}</td>
                                            <td style="padding: 16px; border-bottom: 1px solid #f3f4f6;">
                                                <div style="display: flex; gap: 8px;">
                                                    <button onclick="editUser(${user.id})" style="background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">Edit</button>
                                                    <button onclick="toggleUserStatus(${user.id}, ${user.active})" style="background: ${user.active ? '#ef4444' : '#10b981'}; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">
                                                        ${user.active ? 'Disable' : 'Enable'}
                                                    </button>
                                                    <button onclick="deleteUser(${user.id})" style="background: #dc2626; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">Delete</button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        ${users.length === 0 ? `
                            <div style="margin-top: 24px; padding: 24px; background: #f8fafc; border-radius: 12px; text-align: center; color: #6b7280;">
                                <p>No users found.</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function filterUsersTable() {
            const searchInput = document.getElementById('users-search');
            const table = document.getElementById('users-table');
            const tbody = table.querySelector('tbody');
            const rows = tbody.querySelectorAll('tr');
            const query = searchInput.value.toLowerCase();
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        // User Management Functions
        function showAddUserModal() {
            const modal = document.createElement('div');
            modal.id = 'add-user-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 32px; max-width: 500px; width: 90%;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="margin: 0; color: #111827; font-size: 24px;">üë§ Add New User</h2>
                        <button onclick="closeUserModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">√ó</button>
                    </div>
                    
                    <form id="add-user-form">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Full Name:</label>
                            <input type="text" id="user-name" required style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Email Address:</label>
                            <input type="email" id="user-email" required style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Role:</label>
                            <select id="user-role" required style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                                <option value="user">User</option>
                                <option value="manager">Manager</option>
                                <option value="admin">Administrator</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Initial Password:</label>
                            <input type="password" id="user-password" required style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                        </div>
                        
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button type="button" onclick="closeUserModal()" class="btn btn-secondary" style="padding: 12px 24px; background: #6b7280; color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">Cancel</button>
                            <button type="submit" class="btn btn-primary" style="padding: 12px 24px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">Add User</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add form submit handler
            document.getElementById('add-user-form').addEventListener('submit', handleAddUser);
        }

        function closeUserModal() {
            const modal = document.getElementById('add-user-modal');
            if (modal) {
                modal.remove();
            }
        }

        async function handleAddUser(e) {
            e.preventDefault();
            
            const userData = {
                name: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                role: document.getElementById('user-role').value,
                password: document.getElementById('user-password').value
            };
            
            try {
                showLoading('Creating user...');
                
                // For now, show success message (replace with real API call when backend is connected)
                hideLoading();
                showAlert('success', `User ${userData.name} created successfully!`);
                closeUserModal();
                loadUsersPage(); // Refresh the users list
                
                // Uncomment when connecting to real backend:
                /*
                const response = await fetch('/api/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(userData)
                });
                
                hideLoading();
                
                if (response.ok) {
                    showAlert('success', `User ${userData.name} created successfully!`);
                    closeUserModal();
                    loadUsersPage(); // Refresh the users list
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to create user');
                }
                */
                
            } catch (error) {
                hideLoading();
                console.error('Error creating user:', error);
                showAlert('error', 'Error creating user: ' + error.message);
            }
        }

        async function editUser(userId) {
            // For now, show a comprehensive edit modal (replace with real API call when backend is connected)
            const user = {
                id: userId,
                name: 'John Smith', // Mock data - replace with real user data
                email: 'john.smith@company.com',
                role: 'admin',
                active: true
            };
            
            showEditUserModal(user);
            
            // Uncomment when connecting to real backend:
            /*
            try {
                showLoading('Loading user details...');
                
                const response = await fetch(`/api/users/${userId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                hideLoading();
                
                if (response.ok) {
                    const user = await response.json();
                    showEditUserModal(user);
                } else {
                    throw new Error('Failed to load user details');
                }
            } catch (error) {
                hideLoading();
                console.error('Error loading user:', error);
                showAlert('error', 'Error loading user: ' + error.message);
            }
            */
        }

        function showEditUserModal(user) {
            const modal = document.createElement('div');
            modal.id = 'edit-user-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 32px; max-width: 500px; width: 90%;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="margin: 0; color: #111827; font-size: 24px;">‚úèÔ∏è Edit User</h2>
                        <button onclick="closeEditUserModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">√ó</button>
                    </div>
                    
                    <form id="edit-user-form">
                        <input type="hidden" id="edit-user-id" value="${user.id}">
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Full Name:</label>
                            <input type="text" id="edit-user-name" value="${user.name}" required style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Email Address:</label>
                            <input type="email" id="edit-user-email" value="${user.email}" required style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Role:</label>
                            <select id="edit-user-role" required style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                                <option value="user" ${user.role === 'user' ? 'selected' : ''}>User</option>
                                <option value="manager" ${user.role === 'manager' ? 'selected' : ''}>Manager</option>
                                <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Administrator</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <input type="checkbox" id="edit-user-active" ${user.active ? 'checked' : ''} style="width: 18px; height: 18px;">
                                <span style="font-weight: 600; color: #374151;">Active User</span>
                            </label>
                            <p style="color: #6b7280; font-size: 14px; margin: 0;">Inactive users cannot log in to the system</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">New Password (leave blank to keep current):</label>
                            <input type="password" id="edit-user-password" placeholder="Enter new password" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                        </div>
                        
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button type="button" onclick="closeEditUserModal()" class="btn btn-secondary" style="padding: 12px 24px; background: #6b7280; color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">Cancel</button>
                            <button type="submit" class="btn btn-primary" style="padding: 12px 24px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">Update User</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add form submit handler
            document.getElementById('edit-user-form').addEventListener('submit', handleEditUser);
        }

        function closeEditUserModal() {
            const modal = document.getElementById('edit-user-modal');
            if (modal) {
                modal.remove();
            }
        }

        async function handleEditUser(e) {
            e.preventDefault();
            
            const userData = {
                id: document.getElementById('edit-user-id').value,
                name: document.getElementById('edit-user-name').value,
                email: document.getElementById('edit-user-email').value,
                role: document.getElementById('edit-user-role').value,
                active: document.getElementById('edit-user-active').checked,
                password: document.getElementById('edit-user-password').value || null
            };
            
            try {
                showLoading('Updating user...');
                
                // For now, show success message (replace with real API call when backend is connected)
                hideLoading();
                showAlert('success', `User ${userData.name} updated successfully!`);
                closeEditUserModal();
                loadUsersPage(); // Refresh the users list
                
                // Uncomment when connecting to real backend:
                /*
                const response = await fetch(`/api/users/${userData.id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(userData)
                });
                
                hideLoading();
                
                if (response.ok) {
                    showAlert('success', `User ${userData.name} updated successfully!`);
                    closeEditUserModal();
                    loadUsersPage(); // Refresh the users list
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to update user');
                }
                */
                
            } catch (error) {
                hideLoading();
                console.error('Error updating user:', error);
                showAlert('error', 'Error updating user: ' + error.message);
            }
        }

        async function toggleUserStatus(userId, currentStatus) {
            try {
                showLoading('Updating user status...');
                
                // For now, show success message (replace with real API call when backend is connected)
                hideLoading();
                showAlert('success', `User ${currentStatus ? 'disabled' : 'enabled'} successfully!`);
                loadUsersPage(); // Refresh the users list
                
                // Uncomment when connecting to real backend:
                /*
                const response = await fetch(`/api/users/${userId}/toggle-status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ active: !currentStatus })
                });
                
                hideLoading();
                
                if (response.ok) {
                    showAlert('success', `User ${currentStatus ? 'disabled' : 'enabled'} successfully!`);
                    loadUsersPage(); // Refresh the users list
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to update user status');
                }
                */
                
            } catch (error) {
                hideLoading();
                console.error('Error updating user status:', error);
                showAlert('error', 'Error updating user status: ' + error.message);
            }
        }

        async function deleteUser(userId) {
            if (!confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                return;
            }
            
            try {
                showLoading('Deleting user...');
                
                // For now, show success message (replace with real API call when backend is connected)
                hideLoading();
                showAlert('success', 'User deleted successfully!');
                loadUsersPage(); // Refresh the users list
                
                // Uncomment when connecting to real backend:
                /*
                const response = await fetch(`/api/users/${userId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                hideLoading();
                
                if (response.ok) {
                    showAlert('success', 'User deleted successfully!');
                    loadUsersPage(); // Refresh the users list
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to delete user');
                }
                */
                
            } catch (error) {
                hideLoading();
                console.error('Error deleting user:', error);
                showAlert('error', 'Error deleting user: ' + error.message);
            }
        }

        function loadHandoffNotesPage() {
            const pageContent = document.getElementById('page-content');
            pageContent.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                            <h3 style="margin-bottom: 16px;">üìã Handoff Notes</h3>
                            <p>Shift handoff documentation and communication tools will be implemented here.</p>
                            <div style="margin-top: 24px;">
                                <button class="btn btn-primary" style="margin: 0 8px;">Create Handoff Note</button>
                                <button class="btn btn-secondary" style="margin: 0 8px;">View Previous Handoffs</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadBackupSettingsPage() {
            const pageContent = document.getElementById('page-content');
            pageContent.innerHTML = `
                <!-- Backup & Settings Dashboard -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px;">
                    
                    <!-- Automated Backup Section -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üîÑ Automated Backup</h3>
                        </div>
                        <div class="card-body">
                            <div style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                    <input type="checkbox" id="auto-backup-enabled" checked style="width: 18px; height: 18px;">
                                    <span style="font-weight: 600; color: #374151;">Enable Automated Backups</span>
                                </label>
                                <p style="color: #6b7280; font-size: 14px; margin: 0;">Automatically backup database and files daily</p>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Backup Frequency:</label>
                                <select id="backup-frequency" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                                    <option value="daily">Daily (Recommended)</option>
                                    <option value="twice-daily">Twice Daily</option>
                                    <option value="weekly">Weekly</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Backup Time:</label>
                                <input type="time" id="backup-time" value="02:00" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                                <p style="color: #6b7280; font-size: 12px; margin-top: 4px;">Backup will run at this time daily</p>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Retention Period:</label>
                                <select id="backup-retention" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                                    <option value="7">7 days</option>
                                    <option value="14">14 days</option>
                                    <option value="30" selected>30 days</option>
                                    <option value="90">90 days</option>
                                </select>
                            </div>
                            
                            <button onclick="saveBackupSettings()" class="btn btn-primary" style="width: 100%; padding: 12px 24px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">üíæ Save Backup Settings</button>
                        </div>
                    </div>
                    
                    <!-- Manual Backup Section -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üì¶ Manual Backup</h3>
                        </div>
                        <div class="card-body">
                            <div style="margin-bottom: 20px;">
                                <p style="color: #6b7280; font-size: 14px; margin-bottom: 16px;">Create an immediate backup of the entire system</p>
                                <button onclick="createManualBackup()" class="btn btn-success" style="width: 100%; padding: 12px 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">üîÑ Create Backup Now</button>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Backup Description:</label>
                                <input type="text" id="backup-description" placeholder="e.g., Pre-update backup, Monthly backup" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Restore Section -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üîÑ Restore System</h3>
                        </div>
                        <div class="card-body">
                            <div style="margin-bottom: 20px;">
                                <p style="color: #6b7280; font-size: 14px; margin-bottom: 16px;">Restore system from a previous backup</p>
                                <button onclick="showRestoreModal()" class="btn btn-warning" style="width: 100%; padding: 12px 24px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">üîÑ Restore from Backup</button>
                            </div>
                            
                            <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                                <p style="color: #991b1b; font-size: 12px; margin: 0;">
                                    ‚ö†Ô∏è <strong>Warning:</strong> Restoring will overwrite current data. Make sure to backup current state first.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Information -->
                    <div class="card">
                        <div class="card-header">
                            <h3>‚ÑπÔ∏è System Information</h3>
                        </div>
                        <div class="card-body">
                            <div style="margin-bottom: 16px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="color: #6b7280;">Database Size:</span>
                                    <span style="font-weight: 500;">2.4 GB</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="color: #6b7280;">Last Backup:</span>
                                    <span style="font-weight: 500;">2024-01-15 02:00</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="color: #6b7280;">Backup Status:</span>
                                    <span style="color: #10b981; font-weight: 500;">‚úÖ Successful</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="color: #6b7280;">Available Backups:</span>
                                    <span style="font-weight: 500;">15 backups</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #6b7280;">Storage Used:</span>
                                    <span style="font-weight: 500;">45.2 GB / 100 GB</span>
                                </div>
                            </div>
                            
                            <button onclick="viewBackupHistory()" class="btn btn-secondary" style="width: 100%; padding: 12px 24px; background: #6b7280; color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">üìã View Backup History</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Authentication functions
        async function handleLogin(e) {
            e.preventDefault();
            console.log('üîê Attempting login...');
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginError = document.getElementById('login-error');
            const loginText = document.getElementById('login-text');
            const loginLoading = document.getElementById('login-loading');
            
            // Show loading state
            loginText.classList.add('hidden');
            loginLoading.classList.remove('hidden');
            loginError.classList.add('hidden');
            
            try {
                // For now, use mock authentication (replace with real API call when backend is connected)
                if (email === 'admin@company.com' && password === 'admin123') {
                    authToken = 'mock-token-123';
                    currentUser = {
                        id: 1,
                        name: 'Administrator',
                        email: email,
                        role: 'admin'
                    };
                    localStorage.setItem('authToken', authToken);
                    
                    console.log('‚úÖ Login successful!');
                    showApp();
                    loadCurrentShift();
                } else if (email === 'user@company.com' && password === 'user123') {
                    authToken = 'mock-token-456';
                    currentUser = {
                        id: 2,
                        name: 'Regular User',
                        email: email,
                        role: 'user'
                    };
                    localStorage.setItem('authToken', authToken);
                    
                    console.log('‚úÖ Login successful!');
                    showApp();
                    loadCurrentShift();
                } else {
                    throw new Error('Invalid email or password');
                }
                
                // Uncomment when connecting to real backend:
                /*
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Login failed');
                }
                
                authToken = data.token;
                currentUser = data.user;
                localStorage.setItem('authToken', authToken);
                
                console.log('‚úÖ Login successful!');
                showApp();
                loadCurrentShift();
                */
                
            } catch (error) {
                console.error('‚ùå Login error:', error);
                loginError.textContent = error.message;
                loginError.classList.remove('hidden');
            } finally {
                loginText.classList.remove('hidden');
                loginLoading.classList.add('hidden');
            }
        }

        function validateTokenAndShowApp() {
            try {
                if (authToken) {
                    // Verify token by making a test API call
                    fetch('/api/dashboard', {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    }).then(response => {
                        if (response.ok) {
                            console.log('‚úÖ Token valid, showing app...');
                            showApp();
                            loadCurrentShift();
                        } else {
                            throw new Error('Invalid token');
                        }
                    }).catch(error => {
                        console.error('‚ùå Token validation failed:', error);
                        localStorage.removeItem('authToken');
                        authToken = null;
                        showLogin();
                    });
                } else {
                    showLogin();
                }
            } catch (error) {
                console.error('‚ùå Token validation failed:', error);
                localStorage.removeItem('authToken');
                authToken = null;
                showLogin();
            }
        }

        function logout() {
            console.log('üö™ Logging out...');
            localStorage.removeItem('authToken');
            authToken = null;
            currentUser = null;
            showLogin();
        }

        function showLogin() {
            console.log('üîê Showing login page...');
            const loginPage = document.getElementById('login-page');
            const appContainer = document.getElementById('app-container');
            
            if (loginPage) loginPage.classList.remove('hidden');
            if (appContainer) appContainer.classList.add('hidden');
        }

        function showApp() {
            console.log('üì± Showing app...');
            const loginPage = document.getElementById('login-page');
            const appContainer = document.getElementById('app-container');
            
            if (loginPage) loginPage.classList.add('hidden');
            if (appContainer) appContainer.classList.remove('hidden');
            
            if (currentUser) {
                const userName = currentUser.name || currentUser.email.split('@')[0];
                const userRole = currentUser.role || 'user';
                
                const userNameEl = document.getElementById('user-name');
                const userRoleEl = document.getElementById('user-role');
                
                if (userNameEl) userNameEl.textContent = userName;
                if (userRoleEl) userRoleEl.textContent = userRole.toUpperCase();
                
                // Show/hide role-based nav items
                const usersNav = document.getElementById('users-nav');
                if (usersNav) {
                    usersNav.style.display = (userRole === 'admin' || userRole === 'manager') ? 'block' : 'none';
                }
            }
            
            loadPageContent(currentPage);
        }





        function showLoading(message = 'Loading...') {
            const existingLoader = document.getElementById('loading-indicator');
            if (existingLoader) {
                existingLoader.remove();
            }
            
            const loader = document.createElement('div');
            loader.id = 'loading-indicator';
            loader.style.cssText = `
                position: fixed; 
                top: 50%; 
                left: 50%; 
                transform: translate(-50%, -50%); 
                background: white; 
                padding: 20px 30px; 
                border-radius: 12px; 
                box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
                z-index: 10000;
                border: 1px solid #e5e7eb;
                font-weight: 500;
                color: #374151;
            `;
            loader.textContent = message;
            
            document.body.appendChild(loader);
        }

        function hideLoading() {
            const loader = document.getElementById('loading-indicator');
            if (loader) {
                loader.remove();
            }
        }

        function showAlert(type, message) {
            console.log(`üîî Alert (${type}):`, message);
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 20px;
                border-radius: 10px;
                font-size: 14px;
                font-weight: 500;
                border: 1px solid;
                z-index: 10000;
                max-width: 400px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            
            // Set colors based on type
            switch(type) {
                case 'success':
                    alert.style.background = '#ecfdf5';
                    alert.style.color = '#065f46';
                    alert.style.borderColor = '#a7f3d0';
                    break;
                case 'error':
                    alert.style.background = '#fef2f2';
                    alert.style.color = '#991b1b';
                    alert.style.borderColor = '#fecaca';
                    break;
                case 'warning':
                    alert.style.background = '#fffbeb';
                    alert.style.color = '#92400e';
                    alert.style.borderColor = '#fed7aa';
                    break;
                case 'info':
                    alert.style.background = '#eff6ff';
                    alert.style.color = '#1e40af';
                    alert.style.borderColor = '#bfdbfe';
                    break;
            }
            
            document.body.appendChild(alert);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        // Placeholder functions for inventory management
        function showAddInventoryModal() {
            showAlert('info', 'Add inventory item modal would open here');
        }

        function adjustInventoryItem(itemId) {
            const newQuantity = prompt('Enter new quantity for this item:');
            if (newQuantity !== null && !isNaN(newQuantity)) {
                const quantity = parseInt(newQuantity);
                updateInventoryQuantity(itemId, quantity);
            }
        }

        async function updateInventoryQuantity(itemId, newQuantity) {
            try {
                showLoading('Updating inventory...');
                
                const response = await fetch(`/api/inventory/${itemId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ quantity: newQuantity })
                });
                
                hideLoading();
                
                if (response.ok) {
                    showAlert('success', 'Inventory quantity updated successfully');
                    loadInventoryPage(); // Reload the page
                } else {
                    throw new Error('Failed to update inventory quantity');
                }
            } catch (error) {
                hideLoading();
                console.error('Error updating inventory:', error);
                showAlert('error', 'Error updating inventory: ' + error.message);
            }
        }

        async function deleteInventoryItem(itemId) {
            if (confirm('Are you sure you want to delete this inventory item?')) {
                try {
                    showLoading('Deleting item...');
                    
                    const response = await fetch(`/api/inventory/${itemId}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    
                    hideLoading();
                    
                    if (response.ok) {
                        showAlert('success', 'Inventory item deleted successfully');
                        loadInventoryPage(); // Reload the page
                    } else {
                        throw new Error('Failed to delete inventory item');
                    }
                } catch (error) {
                    hideLoading();
                    console.error('Error deleting inventory:', error);
                    showAlert('error', 'Error deleting inventory: ' + error.message);
                }
            }
        }

        // Inline editing functionality for inventory table
        function makeEditable(cell, itemId, field) {
            if (cell.querySelector('input')) return; // Already editing
            
            const originalValue = cell.textContent.trim();
            const input = document.createElement('input');
            input.type = field === 'quantity' ? 'number' : 'text';
            input.value = originalValue;
            input.style.cssText = 'width: 100%; padding: 4px 8px; border: 2px solid #3b82f6; border-radius: 4px; font-size: 14px; background: white;';
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            input.select();
            
            const saveEdit = async () => {
                const newValue = input.value.trim();
                if (newValue === originalValue) {
                    cell.textContent = originalValue;
                    return;
                }
                
                // Update the cell immediately for better UX
                cell.textContent = newValue;
                
                // For now, just show success message (replace with real API call when backend is connected)
                showAlert('success', `Updated ${field} from "${originalValue}" to "${newValue}"`);
                
                // Uncomment when connecting to real backend:
                /*
                try {
                    const response = await fetch(`/api/inventory/${itemId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({ [field]: newValue })
                    });
                    
                    if (response.ok) {
                        cell.textContent = newValue;
                        if (field === 'quantity') {
                            // Update color for low stock
                            const qty = parseInt(newValue);
                            if (qty <= 5) {
                                cell.style.color = '#ef4444';
                                cell.style.fontWeight = '600';
                            } else {
                                cell.style.color = '';
                                cell.style.fontWeight = '';
                            }
                        }
                        showAlert('success', `Updated ${field} successfully`);
                    } else {
                        throw new Error('Failed to update');
                    }
                } catch (error) {
                    console.error('Error updating inventory:', error);
                    cell.textContent = originalValue;
                    showAlert('error', `Error updating ${field}: ${error.message}`);
                }
                */
            };
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveEdit();
                } else if (e.key === 'Escape') {
                    cell.textContent = originalValue;
                }
            });
        }

        function filterInventoryTable() {
            const searchInput = document.getElementById('inventory-search');
            const table = document.getElementById('inventory-table');
            
            if (!table || !searchInput) return;
            
            const tbody = table.querySelector('tbody');
            const rows = tbody.querySelectorAll('tr');
            const query = searchInput.value.toLowerCase();
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.inventory-search')) {
                document.querySelectorAll('.search-dropdown').forEach(dropdown => {
                    dropdown.classList.add('hidden');
                });
            }
        });

        // Inventory Import Functions
        function showImportModal() {
            const modal = document.createElement('div');
            modal.id = 'import-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 32px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="margin: 0; color: #111827; font-size: 24px;">üì• Import Inventory from Excel</h2>
                        <button onclick="closeImportModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <h3 style="margin-bottom: 16px; color: #374151; font-size: 18px;">Instructions</h3>
                        <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border-left: 4px solid #3b82f6;">
                            <p style="margin-bottom: 12px; color: #374151;"><strong>Excel Format Required:</strong></p>
                            <ul style="margin: 0; padding-left: 20px; color: #6b7280;">
                                <li>First row should contain headers: Part #, Vendor, Product Name, Description, Location, Quantity</li>
                                <li>Data should start from row 2</li>
                                <li>Supported formats: .xlsx, .xls, .csv</li>
                                <li>Maximum file size: 10MB</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Select Excel File:</label>
                        <input type="file" id="excel-file" accept=".xlsx,.xls,.csv" style="width: 100%; padding: 12px; border: 2px dashed #d1d5db; border-radius: 8px; background: #f9fafb;" onchange="handleFileSelect(this)">
                    </div>
                    
                    <div id="file-preview" style="display: none; margin-bottom: 24px;">
                        <h4 style="margin-bottom: 12px; color: #374151;">File Preview:</h4>
                        <div id="preview-content" style="background: #f8fafc; border-radius: 8px; padding: 16px; max-height: 200px; overflow-y: auto;"></div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button onclick="closeImportModal()" class="btn btn-secondary" style="padding: 12px 24px; background: #6b7280; color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">Cancel</button>
                        <button onclick="importInventory()" id="import-btn" class="btn btn-success" disabled style="padding: 12px 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">Import Inventory</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeImportModal() {
            const modal = document.getElementById('import-modal');
            if (modal) {
                modal.remove();
            }
        }

        function handleFileSelect(input) {
            const file = input.files[0];
            const importBtn = document.getElementById('import-btn');
            const filePreview = document.getElementById('file-preview');
            const previewContent = document.getElementById('preview-content');
            
            if (!file) {
                importBtn.disabled = true;
                filePreview.style.display = 'none';
                return;
            }
            
            // Check file size (10MB limit)
            if (file.size > 10 * 1024 * 1024) {
                showAlert('error', 'File size exceeds 10MB limit');
                input.value = '';
                importBtn.disabled = true;
                filePreview.style.display = 'none';
                return;
            }
            
            // Check file type
            const validTypes = [
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', // .xlsx
                'application/vnd.ms-excel', // .xls
                'text/csv' // .csv
            ];
            
            if (!validTypes.includes(file.type) && !file.name.match(/\.(xlsx|xls|csv)$/i)) {
                showAlert('error', 'Please select a valid Excel or CSV file');
                input.value = '';
                importBtn.disabled = true;
                filePreview.style.display = 'none';
                return;
            }
            
            // Show file info
            filePreview.style.display = 'block';
            previewContent.innerHTML = `
                <div style="margin-bottom: 8px;">
                    <strong>File:</strong> ${file.name}
                </div>
                <div style="margin-bottom: 8px;">
                    <strong>Size:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB
                </div>
                <div style="margin-bottom: 8px;">
                    <strong>Type:</strong> ${file.type || 'Unknown'}
                </div>
                <div style="color: #10b981; font-weight: 500;">
                    ‚úÖ File is valid and ready for import
                </div>
            `;
            
            importBtn.disabled = false;
        }

        async function importInventory() {
            const fileInput = document.getElementById('excel-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('error', 'Please select a file first');
                return;
            }
            
            try {
                showLoading('Processing Excel file...');
                
                const formData = new FormData();
                formData.append('file', file);
                
                // For now, show success message (replace with real API call when backend is connected)
                hideLoading();
                showAlert('success', 'Inventory import completed successfully! 150 items imported.');
                
                // Close modal and refresh inventory table
                closeImportModal();
                
                // Uncomment when connecting to real backend:
                /*
                const response = await fetch('/api/inventory/import', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` },
                    body: formData
                });
                
                hideLoading();
                
                if (response.ok) {
                    const result = await response.json();
                    showAlert('success', `Inventory import completed successfully! ${result.importedCount} items imported.`);
                    closeImportModal();
                    // Refresh inventory table
                    loadInventoryPage();
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Import failed');
                }
                */
                
            } catch (error) {
                hideLoading();
                console.error('Import error:', error);
                showAlert('error', 'Error importing inventory: ' + error.message);
            }
        }

        // Save Shift Note Function
        async function saveShiftNote() {
            try {
                showLoading('Saving shift note...');
                
                // Collect shift header data
                const shiftData = {
                    title: document.getElementById('shift-title').value,
                    date: document.getElementById('shift-date').value,
                    shift_type: document.getElementById('shift-type').value,
                    completed_audits: []
                };
                
                // Collect completed audits
                const auditCheckboxes = document.querySelectorAll('.audit-checkbox:checked');
                auditCheckboxes.forEach(checkbox => {
                    shiftData.completed_audits.push(checkbox.value);
                });
                
                // Collect tasks data
                const tasks = [];
                const taskContainers = document.querySelectorAll('.task-container');
                
                taskContainers.forEach((container, index) => {
                    const task = {
                        title: container.querySelector('.task-title').value,
                        status: container.querySelector('.task-status').value,
                        description: container.querySelector('.task-description').value,
                        ticket_number: container.querySelector('.servicenow-ticket')?.value || '',
                        inventory_items: [],
                        files: []
                    };
                    
                    // Collect inventory items for this task
                    const inventoryItems = container.querySelectorAll('.inventory-item');
                    inventoryItems.forEach(item => {
                        const itemId = item.getAttribute('data-item-id');
                        const quantity = item.querySelector('input[type="number"]')?.value || 1;
                        const partNumber = item.querySelector('strong')?.textContent || '';
                        const product = item.querySelector('div')?.textContent || '';
                        
                        task.inventory_items.push({
                            id: itemId,
                            part_number: partNumber,
                            product: product,
                            quantity: parseInt(quantity)
                        });
                    });
                    
                    // Collect file attachments for this task
                    const uploadAreas = container.querySelectorAll('.upload-area');
                    uploadAreas.forEach(area => {
                        const fileInput = area.querySelector('input[type="file"]');
                        if (fileInput && fileInput.files.length > 0) {
                            task.files.push({
                                name: fileInput.files[0].name,
                                size: fileInput.files[0].size,
                                type: fileInput.files[0].type
                            });
                        }
                    });
                    
                    tasks.push(task);
                });
                
                shiftData.tasks = tasks;
                
                console.log('üìù Saving shift data:', shiftData);
                
                // For now, just show success message (replace with real API call when backend is connected)
                hideLoading();
                showAlert('success', 'Shift note saved successfully!');
                
                // Uncomment when connecting to real backend:
                /*
                const response = await fetch('/api/shifts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(shiftData)
                });
                
                hideLoading();
                
                if (response.ok) {
                    const result = await response.json();
                    currentShift = result;
                    showAlert('success', 'Shift note saved successfully!');
                } else {
                    throw new Error('Failed to save shift note');
                }
                */
                
            } catch (error) {
                hideLoading();
                console.error('Error saving shift note:', error);
                showAlert('error', 'Error saving shift note: ' + error.message);
            }
        }

        // Teams Notes Search Functions
        function searchTeamsNotes() {
            const searchQuery = document.getElementById('teams-search').value.toLowerCase();
            const cards = document.querySelectorAll('#teams-notes-container .card');
            
            cards.forEach(card => {
                const employee = card.getAttribute('data-employee') || '';
                const date = card.getAttribute('data-date') || '';
                const shift = card.getAttribute('data-shift') || '';
                const tasks = card.getAttribute('data-tasks') || '';
                const tickets = card.getAttribute('data-tickets') || '';
                const inventory = card.getAttribute('data-inventory') || '';
                
                const searchableText = `${employee} ${date} ${shift} ${tasks} ${tickets} ${inventory}`.toLowerCase();
                
                if (searchableText.includes(searchQuery)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function clearTeamsSearch() {
            document.getElementById('teams-search').value = '';
            const cards = document.querySelectorAll('#teams-notes-container .card');
            cards.forEach(card => {
                card.style.display = 'block';
            });
        }

        function filterByDate(period) {
            const today = new Date();
            const cards = document.querySelectorAll('#teams-notes-container .card');
            
            cards.forEach(card => {
                const cardDate = new Date(card.getAttribute('data-date'));
                let show = false;
                
                switch(period) {
                    case 'today':
                        show = cardDate.toDateString() === today.toDateString();
                        break;
                    case 'week':
                        const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                        show = cardDate >= weekAgo;
                        break;
                    case 'month':
                        const monthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
                        show = cardDate >= monthAgo;
                        break;
                }
                
                card.style.display = show ? 'block' : 'none';
            });
        }

        function filterByShift(shiftType) {
            const cards = document.querySelectorAll('#teams-notes-container .card');
            
            cards.forEach(card => {
                const cardShift = card.getAttribute('data-shift');
                card.style.display = cardShift === shiftType ? 'block' : 'none';
            });
        }

        // Generate Shift Summary Function
        async function generateShiftSummary() {
            try {
                showLoading('Generating shift summary...');
                
                // Collect the same data as saveShiftNote
                const shiftData = {
                    title: document.getElementById('shift-title').value,
                    date: document.getElementById('shift-date').value,
                    shift_type: document.getElementById('shift-type').value,
                    completed_audits: []
                };
                
                // Collect completed audits
                const auditCheckboxes = document.querySelectorAll('.audit-checkbox:checked');
                auditCheckboxes.forEach(checkbox => {
                    shiftData.completed_audits.push(checkbox.value);
                });
                
                // Collect tasks data
                const tasks = [];
                const taskContainers = document.querySelectorAll('.task-container');
                
                taskContainers.forEach((container, index) => {
                    const task = {
                        title: container.querySelector('.task-title').value,
                        status: container.querySelector('.task-status').value,
                        description: container.querySelector('.task-description').value,
                        ticket_number: container.querySelector('.servicenow-ticket')?.value || '',
                        inventory_items: [],
                        files: []
                    };
                    
                    // Collect inventory items for this task
                    const inventoryItems = container.querySelectorAll('.inventory-item');
                    inventoryItems.forEach(item => {
                        const itemId = item.getAttribute('data-item-id');
                        const quantity = item.querySelector('input[type="number"]')?.value || 1;
                        const partNumber = item.querySelector('strong')?.textContent || '';
                        const product = item.querySelector('div')?.textContent || '';
                        
                        task.inventory_items.push({
                            id: itemId,
                            part_number: partNumber,
                            product: product,
                            quantity: parseInt(quantity)
                        });
                    });
                    
                    tasks.push(task);
                });
                
                shiftData.tasks = tasks;
                
                // Generate summary text
                let summary = `# ${shiftData.title}\n\n`;
                summary += `**Date:** ${shiftData.date}\n`;
                summary += `**Shift Type:** ${shiftData.shift_type}\n\n`;
                
                if (shiftData.completed_audits.length > 0) {
                    summary += `## Completed Audits\n`;
                    shiftData.completed_audits.forEach(audit => {
                        summary += `- ‚úÖ ${audit}\n`;
                    });
                    summary += '\n';
                }
                
                if (tasks.length > 0) {
                    summary += `## Tasks\n\n`;
                    tasks.forEach((task, index) => {
                        summary += `### Task ${index + 1}: ${task.title}\n`;
                        summary += `**Status:** ${task.status}\n`;
                        summary += `**Description:** ${task.description}\n`;
                        if (task.ticket_number) {
                            summary += `**ServiceNow Ticket:** ${task.ticket_number}\n`;
                        }
                        if (task.inventory_items.length > 0) {
                            summary += `**Inventory Items Used:**\n`;
                            task.inventory_items.forEach(item => {
                                summary += `- ${item.part_number} - ${item.product} (Qty: ${item.quantity})\n`;
                            });
                        }
                        summary += '\n';
                    });
                }
                hideLoading();
                // Create and download the summary file
                const blob = new Blob([summary], { type: 'text/markdown' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `shift-summary-${shiftData.date}.md`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                showAlert('success', 'Shift summary generated and downloaded!');
            } catch (error) {
                hideLoading();
                console.error('Error generating shift summary:', error);
                showAlert('error', 'Error generating shift summary: ' + error.message);
            }
        }
    </script>
</body>
</html>